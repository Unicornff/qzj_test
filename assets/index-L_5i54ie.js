import{a as y,j as r,n as M,Q as x,U as B,y as D,h as _,B as T,A as z,b as k,o as h,w as g,I as w,c as S,f as C,e as i,g as $,_ as N}from"./index-CFNvAuOJ.js";const W={key:0,class:"loading-container"},A=y({__name:"ScrollLoadTable",props:{data:{type:Array,required:!0,default:[]},initLoading:{type:Boolean,default:!1},loadMoreLoading:{type:Boolean,default:!1},pageSize:{type:Number,default:20},hasMore:{type:Boolean,default:!0}},emits:["loadMoreData"],setup(b,{emit:c}){const o=b,d=c,s=r(1),u=r(null);let t=null;M(()=>{x(()=>{t=u.value.$refs.bodyWrapper.querySelector(".el-scrollbar__wrap"),t&&t.addEventListener("scroll",p)})}),D(()=>{t&&t.removeEventListener("scroll",p)});const p=B.lodashThrottle(a=>{if(!o.hasMore)return;const e=a.target;e.scrollHeight-e.scrollTop-e.clientHeight<5&&n()},300),n=()=>{s.value++,d("loadMoreData",s.value,o.pageSize)};return(a,e)=>{const l=_("loading"),f=_("el-icon"),L=_("el-table"),m=T("loading");return z((h(),k(L,{ref_key:"scrollLoadTableContainer",ref:u,data:o.data,height:"100%"},{append:g(()=>[o.loadMoreLoading?(h(),S("div",W,[i(f,{class:"loading-icon"},{default:g(()=>[i(l)]),_:1}),e[0]||(e[0]=$("span",{class:"loading-text"},"加载中...",-1))])):C("",!0)]),default:g(()=>[w(a.$slots,"default",{},void 0,!0)]),_:3},8,["data"])),[[m,o.initLoading]])}}}),E=N(A,[["__scopeId","data-v-5a61a147"]]),U={class:"full-size box-bg-color box-padding"},q=y({__name:"index",setup(b){const c=r([]),o=r(20),d=r(!1),s=r(!1),u=r(!0);M(()=>{t(1,o.value)});const t=async(n,a)=>{n===1?d.value=!0:s.value=!0;try{let l=await p({pageNum:n,pageSize:a});c.value=[...c.value,...l],l.length<a&&(u.value=!1)}catch(e){console.log(e)}finally{d.value=!1,s.value=!1}},p=n=>{const{pageNum:a,pageSize:e}=n;return new Promise(l=>{setTimeout(()=>{if(a>5){l([{name:"姓名 101",age:20,address:"地址 101"}]);return}const f=Array.from({length:e},(L,m)=>{const v=(a-1)*e+m+1;return{name:`姓名 ${v}`,age:20+v%10,address:`地址 ${v}`}});l(f)},a===1?300:1e3)})};return(n,a)=>{const e=_("el-table-column");return h(),S("div",U,[i(E,{data:c.value,initLoading:d.value,loadMoreLoading:s.value,pageSize:o.value,hasMore:u.value,onLoadMoreData:t},{default:g(()=>[i(e,{prop:"name",label:"姓名"}),i(e,{prop:"age",label:"年龄"}),i(e,{prop:"address",label:"地址"})]),_:1},8,["data","initLoading","loadMoreLoading","pageSize","hasMore"])])}}});export{q as default};
